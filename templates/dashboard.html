<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Wellness Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Welcome Header -->
        <div class="welcome-header">
            <h1>🌟 Welcome back, {{ user.name|title }}!</h1>
            <p class="daily-motivation">💚 <strong>Today's Focus:</strong> {{ contextual_message }}</p>
        </div>

        <!-- Progress Stats Row -->
        <div class="progress-stats">
            <div class="stat-card">
                <div class="stat-icon">🔥</div>
                <div class="stat-number">{{ streak_days }}</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">📋</div>
                <div class="stat-number">{{ total_logs }}</div>
                <div class="stat-label">Total Logs</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">📅</div>
                <div class="stat-number">{{ days_since_signup + 1 }}</div>
                <div class="stat-label">Days Active</div>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="main-dashboard-grid">
            <!-- Quick Score Card -->
            <div class="dashboard-card score-card">
                <div class="card-header">
                    <h3>📊 Your Daily Score</h3>
                </div>
                <div class="card-content">
                    {% if recent_score %}
                        <div class="score-display">
                            <span class="score-number">{{ recent_score }}</span>
                            <span class="score-max">/10</span>
                        </div>
                        <p class="score-description">Based on your latest entries</p>
                    {% else %}
                        <div class="score-display ready">Ready!</div>
                        <p class="score-description">Complete your daily log to see your score</p>
                    {% endif %}
                </div>
            </div>

            <!-- Cycle Status Card -->
            {% if user.profile_data.menstrualCycle %}
            <div class="dashboard-card cycle-card">
                <div class="card-header">
                    <h3>🌸 Your Cycle Today</h3>
                </div>
                <div class="card-content">
                    <div class="cycle-status">
                        <div class="cycle-phase">{{ user.profile_data.menstrualCycle|replace('_', ' ')|title }}</div>
                        <div class="cycle-tip">
                            {% if 'first_half' in user.profile_data.menstrualCycle %}
                                💧 Stay hydrated and be gentle with yourself during this time
                            {% elif 'second_half' in user.profile_data.menstrualCycle %}
                                🌿 Light movement and rest can help ease any discomfort
                            {% elif 'ovulation' in user.profile_data.menstrualCycle %}
                                ⚡ You might have more energy - perfect for trying new activities!
                            {% elif 'early_luteal' in user.profile_data.menstrualCycle %}
                                🧘 Great time to focus on strength training and protein
                            {% elif 'late_luteal' in user.profile_data.menstrualCycle %}
                                🍃 Consider gentle yoga and magnesium-rich foods
                            {% else %}
                                💪 Listen to your body and adjust your routine as needed
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Your Goal Card -->
            <div class="dashboard-card goal-card">
                <div class="card-header">
                    <h3>🎯 Your Goal</h3>
                </div>
                <div class="card-content">
                    <div class="goal-title">{{ user.profile_data.goal|replace('_', ' ')|title }}</div>
                    <p class="goal-description">{{ user.profile_data.get('motivation', 'Complete your profile to set your motivation and goals!')[:100] }}...</p>
                </div>
            </div>

            <!-- Key Metrics Card -->
            <div class="dashboard-card metrics-card">
                <div class="card-header">
                    <h3>💭 Today's Snapshot</h3>
                </div>
                <div class="card-content">
                    <div class="metric-row">
                        <div class="metric-label">Motivation</div>
                        <div class="metric-value">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ (user.profile_data.get('motivationLevel', 5) * 10) }}%"></div>
                            </div>
                            <span class="metric-number">{{ user.profile_data.get('motivationLevel', 5) }}/10</span>
                        </div>
                    </div>
                    <div class="metric-row">
                        <div class="metric-label">Stress Level</div>
                        <div class="metric-value">
                            <div class="progress-bar">
                                <div class="progress-fill stress-bar" style="width: {{ (user.profile_data.get('stressLevel', 3) * 10) }}%"></div>
                            </div>
                            <span class="metric-number">{{ user.profile_data.get('stressLevel', 3) }}/10</span>
                        </div>
                    </div>
                    <div class="metric-row">
                        <div class="metric-label">Sleep Hours</div>
                        <div class="metric-value">
                            <div class="sleep-display">
                                <span class="sleep-icon">😴</span>
                                <span class="metric-number">{{ user.profile_data.get('sleepHours', 7) }}h</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Device Tracking Section -->
        <div class="tracking-philosophy">
            <h3>📱 Your Tracking Journey</h3>
            {% set fitness_tokens = user.get('fitness_tokens', {}) %}
            {% set connected_devices = [] %}
            {% if fitness_tokens.get('fitbit_access_token') %}{% set _ = connected_devices.append('Fitbit') %}{% endif %}
            {% if fitness_tokens.get('oura_access_token') %}{% set _ = connected_devices.append('Oura Ring') %}{% endif %}
            {% if fitness_tokens.get('google_fit_access_token') %}{% set _ = connected_devices.append('Google Fit') %}{% endif %}

            <div class="tracking-insight">
                <p class="tracking-message">Your device can track steps and sleep, but only you can track how you feel. Manual logging builds powerful habits, with or without a device. 💪</p>
            </div>

            {% if connected_devices %}
            <div class="device-status connected">
                <div class="device-header">
                    <span class="status-badge connected">✅ {{ connected_devices|length }} device(s) syncing</span>
                    <span class="sync-info">🔄 Auto-sync enabled</span>
                </div>
                <div class="device-grid-mini">
                    {% if 'Fitbit' in connected_devices %}
                    <div class="mini-device-card connected">
                        <div class="device-icon">⌚</div>
                        <small>Fitbit</small>
                    </div>
                    {% endif %}
                    {% if 'Oura Ring' in connected_devices %}
                    <div class="mini-device-card connected">
                        <div class="device-icon">💍</div>
                        <small>Oura Ring</small>
                    </div>
                    {% endif %}
                    {% if 'Google Fit' in connected_devices %}
                    <div class="mini-device-card connected">
                        <div class="device-icon">📱</div>
                        <small>Google Fit</small>
                    </div>
                    {% endif %}
                </div>
                <p class="sync-note">Last sync: {{ user.get('last_device_sync', 'Never') }}</p>
            </div>
            {% else %}
            <div class="device-status not-connected">
                <div class="device-header">
                    <span class="status-badge manual">📝 Manual Check-in — Track your data manually here. Works perfectly without connected devices.</span>
                </div>
                <p class="manual-tracking-encouragement">You're building mindful habits by consciously checking in with yourself. This self-awareness is incredibly valuable for long-term success! 🌟</p>
                <div class="device-grid-mini">
                    <div class="mini-device-card available">
                        <div class="device-icon">⌚</div>
                        <small>Fitbit</small>
                    </div>
                    <div class="mini-device-card available">
                        <div class="device-icon">💍</div>
                        <small>Oura Ring</small>
                    </div>
                    <div class="mini-device-card available">
                        <div class="device-icon">📱</div>
                        <small>Google Fit</small>
                    </div>
                    <div class="mini-device-card available">
                        <div class="device-icon">🍎</div>
                        <small>Apple Health</small>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Achievement Tracker -->
        <div class="achievement-section">
            <h2>🏆 Your Achievements</h2>
            <div class="achievements-grid">
                {% set logs_count = user.get('daily_logs', [])|length %}
                <div class="achievement-card {{ 'unlocked' if logs_count >= 1 else 'locked' }}">
                    <div class="achievement-icon">📝</div>
                    <div class="achievement-title">First Entry</div>
                    <div class="achievement-description">Complete your first daily log</div>
                    <div class="achievement-progress">{{ '✅ Unlocked!' if logs_count >= 1 else '🔒 Locked' }}</div>
                </div>

                <div class="achievement-card {{ 'unlocked' if logs_count >= 7 else 'locked' }}">
                    <div class="achievement-icon">🔥</div>
                    <div class="achievement-title">Week Warrior</div>
                    <div class="achievement-description">Log data for 7 days</div>
                    <div class="achievement-progress">
                        {% if logs_count >= 7 %}
                            ✅ Unlocked!
                        {% else %}
                            {{ logs_count }}/7 days
                        {% endif %}
                    </div>
                </div>

                <div class="achievement-card {{ 'unlocked' if streak_days >= 3 else 'locked' }}">
                    <div class="achievement-icon">⚡</div>
                    <div class="achievement-title">Consistency King</div>
                    <div class="achievement-description">Maintain a 3-day streak</div>
                    <div class="achievement-progress">
                        {% if streak_days >= 3 %}
                            ✅ Unlocked!
                        {% else %}
                            {{ streak_days }}/3 days
                        {% endif %}
                    </div>
                </div>

                {% if goal == 'weight_loss' %}
                <div class="achievement-card locked">
                    <div class="achievement-icon">🎯</div>
                    <div class="achievement-title">Goal Crusher</div>
                    <div class="achievement-description">Reach your weight loss milestone</div>
                    <div class="achievement-progress">Track weight to unlock</div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Next Steps Based on Profile -->
        <div class="next-steps-section">
            <h2>🎯 Recommended Next Steps</h2>
            <div class="next-steps-content">
                {% if logs_count == 0 %}
                    <div class="step-card priority">
                        <div class="step-icon">🚀</div>
                        <div class="step-content">
                            <h3>Start Your Journey!</h3>
                            <p>Complete your first daily log to begin tracking your progress. It takes just 2 minutes!</p>
                            <a href="/daily-log?email={{ user.email }}" class="step-action">Log Your Day</a>
                        </div>
                    </div>
                {% elif logs_count < 3 %}
                    <div class="step-card priority">
                        <div class="step-icon">📈</div>
                        <div class="step-content">
                            <h3>Build Your Habit</h3>
                            <p>You're off to a great start! Log {{ 3 - logs_count }} more day{{ 's' if 3 - logs_count != 1 else '' }} to establish your routine.</p>
                            <a href="/daily-log?email={{ user.email }}" class="step-action">Continue Logging</a>
                        </div>
                    </div>
                {% else %}
                    {% if goal == 'weight_loss' %}
                        <div class="step-card">
                            <div class="step-icon">🥗</div>
                            <div class="step-content">
                                <h3>Focus on Nutrition</h3>
                                <p>Track your meals more consistently to identify patterns that support your weight loss goals.</p>
                                <a href="/daily-log?email={{ user.email }}" class="step-action">Log Meals</a>
                            </div>
                        </div>
                    {% elif goal == 'muscle_gain' %}
                        <div class="step-card">
                            <div class="step-icon">💪</div>
                            <div class="step-content">
                                <h3>Optimize Recovery</h3>
                                <p>Track sleep and stress levels to maximize your muscle-building potential.</p>
                                <a href="/weekly-checkin?email={{ user.email }}" class="step-action">Weekly Check-in</a>
                            </div>
                        </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>

        <!-- Quick Actions Section -->
        <div class="quick-actions-section">
            <h2>🚀 Quick Actions</h2>
            <div class="action-buttons">
                <a href="/daily-log?email={{ user.email }}" class="action-btn primary">
                    <span class="btn-icon">📝</span>
                    <span class="btn-text">Daily Log</span>
                    <span class="btn-subtitle">2 min</span>
                </a>
                <a href="/weekly-checkin?email={{ user.email }}" class="action-btn secondary">
                    <span class="btn-icon">📅</span>
                    <span class="btn-text">Weekly Check-in</span>
                    <span class="btn-subtitle">5 min</span>
                </a>
                <a href="/ai-chat?email={{ user.email }}" class="action-btn accent">
                    <span class="btn-icon">🤖</span>
                    <span class="btn-text">Ask AI</span>
                    <span class="btn-subtitle">Get insights</span>
                </a>
                <a href="/connect-devices?email={{ user.email }}" class="action-btn secondary">
                    <span class="btn-icon">🔗</span>
                    <span class="btn-text">Connect Devices</span>
                    <span class="btn-subtitle">Auto-sync</span>
                </a>
                <a href="/?email={{ user.email }}" class="action-btn tertiary">
                    <span class="btn-icon">⚙️</span>
                    <span class="btn-text">Update Profile</span>
                    <span class="btn-subtitle">Personalize</span>
                </a>
            </div>
        </div>

        {{ motivation_content|safe }}

        <!-- Subscription Status -->
        <div class="subscription-section">
            <div class="subscription-card">
                <h3>💳 Your Plan</h3>
                <div class="plan-info">
                    <span class="plan-name">{{ user.subscription_tier|title }} Plan</span>
                    {% if user.subscription_tier == 'free' %}
                        <span class="plan-status upgrade-available">Upgrade Available!</span>
                    {% else %}
                        <span class="plan-status premium">Premium Active ✨</span>
                    {% endif %}
                </div>
                {% if user.subscription_tier == 'free' %}
                <p class="plan-description">You're using the free plan. Upgrade for unlimited AI insights and advanced features!</p>
                <a href="/subscription?email={{ user.email }}" class="upgrade-btn">Upgrade to Premium</a>
                {% else %}
                <p class="plan-description">You have unlimited access to all premium features! Thank you for your support. 🙏</p>
                {% endif %}
            </div>
        </div>

        <!-- Feature Comparison (moved down) -->
        <div class="feature-comparison">
            <h3>🆚 Free vs Premium Features</h3>
            <div class="feature-grid">
                <div class="feature-column free-column">
                    <h4 style="margin-top: 0; color: #2196f3;">🆓 Free Plan</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #666;">
                        <li>Basic daily logging (7 days)</li>
                        <li>Quick daily score</li>
                        <li>3 AI questions per week</li>
                        <li>Basic wearable data entry</li>
                        <li>7-day data history</li>
                        <li>Email support</li>
                    </ul>
                </div>
                <div class="feature-column premium-column">
                    <h4 style="margin-top: 0; color: #ff9800;">✨ Premium Plan - £9.97/month</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #666;">
                        <li><strong>Unlimited</strong> daily logging & AI chat</li>
                        <li><strong>Advanced</strong> analytics & trends</li>
                        <li><strong>Hormone-aware</strong> recommendations</li>
                        <li><strong>AI meal planning</strong> & suggestions</li>
                        <li><strong>Unlimited</strong> data history</li>
                        <li><strong>Auto wearable sync</strong> (coming soon)</li>
                        <li><strong>Priority</strong> support</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
</html>